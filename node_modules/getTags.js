/* GetTags.js 
 * Author: Russell Kubik
 * An ajax request will call this search function and will in return receive a JSON formatted list of relevant tags
 */ 

var dbAccess = require('dbAccess'), 
	url = require('url');

var GetTags = exports.GetTags = function() {};

/**
 * Search a partial tag
 */
GetTags.search = function(request, response) {
	var parsedURL = url.parse(request.url, true);
	var term = parsedURL.query.term;
	if(term.length>=3)
	{
		dbAccess.runQuery("SELECT * FROM tags ORDER BY tag ASC", function(error, rows) {
			var results = [];
			var numFound = 0;
			var regTerm = new RegExp(term, 'gi');
			for(var i=0; i<rows.length;i++)
			{
				var tempTerm = rows[i].tag;
				if(tempTerm.match(regTerm))
				{
					results[results.length] = tempTerm;
					numFound++;
				}
				if(numFound==5)
					break;
			}
			response.writeHead(200, {'content-type': 'text/json' });
			response.write( JSON.stringify(results) );
			response.end();
		});
	} else {
		var results = [];
		response.writeHead(200, {'content-type': 'text/json' });
		response.write( JSON.stringify(results) );
		response.end();
	}
}
