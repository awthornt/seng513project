var dbAccess = require('dbAccess'), 
	url = require('url'),
	querystring = require('querystring');

var PopularTags = exports.PopularTags = function() {
};

/**
* Send the HTML page to the client
* @param response Response object to send the data
* @param issue Issue to display
*/
function displayPage(response, issue) {
	return function(error, rows) {
		if(rows)
		{
			var variables = {content: rows};
			response.render('views/popularTags.html', variables);
		} else {
		
		}
   };
}

/**
* Main function of the module
* @param request Incoming request
* @param response Response object to send the data
*/
PopularTags.display = function(request, response) {
	var parsedURL = url.parse(request.url, true);

	var sqlQuery = "SELECT issueTags.tag_id, tags.tag, count(*) AS uniquetags FROM ( SELECT tag_id FROM issuetags ) AS issueTags JOIN tags ON issueTags.tag_id=tags.id GROUP BY issueTags.tag_id ORDER BY uniquetags DESC";
	dbAccess.runQuery(sqlQuery, displayPage(response));
};
