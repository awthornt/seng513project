/*
 * A simple test module for routing 
 */ 

var TestModule = exports.TestModule = function() { 
	this.bar = 'bar';  
};

TestModule.foo = function(req, res) {
	throw RangeError; 
}

TestModule.fooBar = function(req, res) {
	res.writeHead(200, { 'Content-Type' : 'text/html' }); 
	res.end('<html><body><h1>FooBar</h1></body></html>');
}


/*
 * Our code!
 * Handle POST form	
 */
var querystring = require('querystring'),
    sqlite = require('sqlite'),
    util = require('util');
    dbAccess = require('./dbAccess.js'); 

TestModule.add = function(req, res) {
    if (req.method == 'POST') {

        req.addListener('data', function(chunk) {
            var POST = querystring.parse(chunk);    

            // insert data into sqlite database
            var db = new sqlite.Database();
            db.open("db/CivicConnect.db", function(error) {
                if(error) {
                    console.log("Error opening sqlite database.");
                    throw error;
                }
               
                // here is their "insert" query
                dbAccess.create('issues', { values: ['user_id="332338"',
                                            'status="active"',
                                            'title=' + POST.title,
                                            'description=' + POST.description,
                                            'link=' + POST.link,
                                            'location=' + POST.location]},
                function(error) {
                    console.log("Error inserting into database!");
                });

            });    // end db.open()
            

        }).addListener('end', function() {

            res.writeHead(200);
            res.end();
        });

    }
}
